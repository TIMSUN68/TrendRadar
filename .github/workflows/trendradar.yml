name: TrendRadar Crawler & Notify
# 工作流名称，可自定义

# 触发条件：1. 定时执行；2. 手动触发
on:
  schedule:
    # Cron 表达式：每小时执行一次（可修改，后续讲）
    - cron: '0 1,10 * * *'
  workflow_dispatch:
    # 允许手动触发（用于测试）

# 执行的任务
jobs:
  run-trendradar:
    # 运行环境：Ubuntu 最新版（GitHub 提供的免费服务器）
    runs-on: ubuntu-latest
    steps:
      # 步骤1：拉取仓库代码（把你的 Fork 仓库代码下载到服务器）
      - name: Checkout code
        uses: actions/checkout@v4

      # 步骤2：安装 Python 环境（TrendRadar 基于 Python 开发）
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'  # 适配 TrendRadar 的 Python 版本

      # 步骤3：安装依赖包（TrendRadar 运行所需的 Python 库）
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt  # 依赖文件在仓库根目录
          # 安装 QQ 邮件所需的 smtplib 依赖（部分环境可能缺失，补充安装）
          pip install secure-smtplib python-dotenv

      # 步骤4：执行爬虫 + 邮件推送（核心步骤）
      - name: Run crawler and send email notify
        env:
          # 从 GitHub Secrets 中读取配置（和你之前添加的密钥名称一致）
          EMAIL_FROM: ${{ secrets.EMAIL_FROM }}
          EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
          EMAIL_TO: ${{ secrets.EMAIL_TO }}
          EMAIL_SMTP_SERVER: ${{ secrets.EMAIL_SMTP_SERVER }}
          EMAIL_SMTP_PORT: ${{ secrets.EMAIL_SMTP_PORT }}
        # 执行 TrendRadar 主程序（不同分支可能入口文件不同，常见 3 种写法，按顺序尝试）
        run:python main.py
          # 写法1：若仓库根目录有 run.py（多数分支）
          python run.py
          # 写法2：若仓库根目录有 main.py（部分分支）
          # python main.py
          # 写法3：若仓库根目录有 trendradar.py（少数分支）
          # python trendradar.py
